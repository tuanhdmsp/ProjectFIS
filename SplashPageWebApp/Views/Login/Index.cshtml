
@{
    ViewBag.Title = "Index";
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <title>Welcome to FPT Information System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="/SplashPage/css/style.css" rel='stylesheet' type='text/css' />
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,100,300,500,700,900' rel='stylesheet' type='text/css'>
    @Scripts.Render("~/bundles/modernizr")
    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")
    <script>
        function sendEmail() {
            var inputValue = $('[name=email]')[0].value;
            if (inputValue) {
                $.ajax({
                    "method": "POST",
                    "dataType": "json",
                    "url": '@Url.Action("CheckEmail")',
                    "data": {
                        "email": inputValue,
                    },
                    "success": function (data) {
                        if (data.success == true) {
                            $('[name=code]').removeAttr('disabled');
                            $('[name=loginWifi]').removeAttr('disabled');
                            $('[name=email]').attr("disabled", "disabled");
                            $('[name=checkEmail]').attr("disabled", "disabled");
                        } else {
                            console.log("Invalid email");
                        }

                    },
                    "error": function(error) {
                        console.log(error);
                    }
                });
            }
        }

        function checkCode() {
            var inputValue = $('[name=code]')[0].value;
            if (inputValue) {
                $.ajax({
                    "method": "POST",
                    "dataType": "json",
                    "url": '@Url.Action("CheckCode")',
                    "data": {
                        "inpCode": inputValue,
                    },
                    "success": function(data) {
                        if (data.success == true) {
                            submitAction();
                            console.log("Redirect");
                        } else {
                            console.log("Wrong code");
                        }
                    },
                    "error": function(error) {
                        console.log(error);
                    }
                });
            }
        };

        function submitAction() {
            var link = document.location.href;
            var searchString = "redirect=";
            var equalIndex = link.indexOf(searchString);
            var redirectUrl = "";

            //if (document.forms[0].action == "") {
                //var url = window.location.href;
                var args = new Object();
                var query = location.search.substring(1);
                var pairs = query.split("&");
                for (var i = 0; i < pairs.length; i++) {
                    var pos = pairs[i].indexOf('=');
                    if (pos == -1) continue;
                    var argname = pairs[i].substring(0, pos);
                    var value = pairs[i].substring(pos + 1);
                    args[argname] = unescape(value);
                }
                document.forms[0].action = args.switch_url;
            //}
            if (equalIndex >= 0) {
                equalIndex += searchString.length;
                redirectUrl = "";
                redirectUrl += link.substring(equalIndex);
            }
            if (redirectUrl.length > 255)
                redirectUrl = redirectUrl.substring(0, 255);
            document.forms[0].redirect_url.value = redirectUrl;
            document.forms[0].buttonClicked.value = 4;
            document.forms[0].submit();
        }

        function reject() {
            alert("You will not be able to access the system!");
        }


        function loadAction() {
            //var url = window.location.href;

            var args = new Object();
            var query = location.search.substring(1);
            var pairs = query.split("&");
            for (var i = 0; i < pairs.length; i++) {
                var pos = pairs[i].indexOf('=');
                if (pos == -1) continue;
                var argname = pairs[i].substring(0, pos);
                var value = pairs[i].substring(pos + 1);
                args[argname] = unescape(value);
            }
            document.forms[0].action = args.switch_url;

        }
    </script>
</head>
<body onload="loadAction();">
<h1>Welcome!<span>FPT Information System</span><br/>
    <span style="font-size: 60%">Register to access free Wi-Fi</span></h1>
<div class="login-box">
    <form method="post" action='@Url.Action("Index", "Login")'>
        
        <input TYPE="hidden" NAME="buttonClicked" SIZE="16" MAXLENGTH="15" value="0">
        <input TYPE="hidden" NAME="redirect_url" SIZE="255" MAXLENGTH="255" VALUE="">
        <input TYPE="hidden" NAME="err_flag" SIZE="16" MAXLENGTH="15" value="0">

        <input type="text" name="email" placeholder="Email">
        <input type="password" name="code" placeholder="Code" disabled="">
        <br/><br/>
        <div class="btn">
            <input type="button" name="checkEmail" onclick="sendEmail()" value="Send Email">
            <input type="button" name="loginWifi" onclick="checkCode()" value="Access Wifi" disabled="">
        </div>
        <div class="clear"></div>
    </form>		
</div>		
</body>
</html>
